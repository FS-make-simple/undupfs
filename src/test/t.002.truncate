starttests t.truncate

test "rewrite a file to shorter and read it back"
printf '%400d\n' 12 > $d/trunc || fail
printf '%100d\n' 13 > $d/trunc || fail
printf '%100d\n' 13 | cmp -s - $d/trunc || fail

test "truncate file to specified block length"
(
printf '%4095d\n' 14 ;
printf '%4095d\n' 15 ;
printf '%4095d\n' 16 ) > $d/trunclen || fail

dd if=/dev/null of=$d/trunclen bs=4k seek=2 || fail
(
printf '%4095d\n' 14;
printf '%4095d\n' 15) | cmp -s - $d/trunclen || fail

test "truncate file to specifed length with append"
(
printf '%4095d\n' 14 ;
printf '%4095d\n' 15 ;
printf '%4095d\n' 16 ;
printf '%4095d\n' 17 ) > $d/trunclen || fail

printf '%4095d\n' 18 | dd of=$d/trunclen bs=4k seek=2 || fail

(
printf '%4095d\n' 14;
printf '%4095d\n' 15;
printf '%4095d\n' 18) | cmp -s - $d/trunclen || fail

test "truncate file to non-blocksize length"
(
printf '%4095d\n' 14 ;
printf '%4095d\n' 15 ;
printf '%4095d\n' 16 ;
printf '%4095d\n' 17 ) > $d/trunclen || fail

echo 18 | dd of=$d/trunclen bs=4k seek=2 || fail

(
printf '%4095d\n' 14;
printf '%4095d\n' 15;
echo 18) | cmp -s - $d/trunclen || fail

endtests t.truncate
